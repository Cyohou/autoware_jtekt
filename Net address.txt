今日问题概览
多个节点在运行回放时出现大量 TF 外推与时间不一致警告（TF_OLD_DATA、Lookup would require extrapolation into the past/future）、GNSS 协方差被替换的警告，以及 EKF 输出非有限/天文数值并被禁用或进程崩溃（"current_ekf_pose_ out of bounds"、"can't subtract times with different time sources" 等）。

关键观测（你提供的证据）
/sensing/gnss/ins/odometry 的 header.stamp 秒值为 1747978732…1747978734（远早于 /clock 的 1758584958…1758584964）。

/sensing/gnss/ins/odometry_filtered 与 /clock 时间对齐（≈1758584960+）。

ros2 topic info 显示 /sensing/gnss/ins/odometry 有两个 publisher（oxts_ins 与 rosbag2_player）。

日志同时出现“extrapolation into the future”和“extrapolation into the past”，并有节点因时间源不一致抛出异常退出。

根本原因（简洁）
并非单一“旧 GNSS odometry”本身，而是系统中存在并发来源与时间源混用导致的交互故障：

同一 topic 被多个来源（实时驱动 + rosbag player）同时发布，带不同 timestamps；

下游节点在不同时间基（/clock vs system time）或在 TF 缓存窗口外收到消息，导致 TF 查找外推失败；

错时或协方差异常的观测流入 EKF，产生极端/非有限 X/P，触发 EKF 禁用或进程崩溃。

已采取或建议的短期可立刻执行的修复（按优先级）
立即停止或重启 EKF（防止进一步污染）。

用 rosbag play remap 将回放输出重定向（避免和实时发布冲突）：ros2 bag play <bag> --clock --remap /sensing/gnss/ins/odometry:=/sensing/gnss/ins/odometry_bag。

启用/运行 timestamp_normalizer（示例脚本已提供）将不可信的 topic（来自 bag）重写为对齐 /clock 的 safe topic（例如 /sensing/gnss/ins/odometry_fixed）。

把 EKF 的订阅 remap 到单一可信的 safe topic（例如 odometry_filtered 或 odometry_fixed）。

确保 TF 广播器、robot_state_publisher 等在回放前启动并使用 use_sim_time=true。

已提供的工具与改动（你已有的或我给出的）
多版 Python scanner 脚本（最终稳定版）供你在回放时检测 topic header.stamp，并处理 CLI 警告与重试竞态；

timestamp_normalizer.py（将早期/异常 stamp 重写为 /clock），可直接运行并发布 fixed topic；

CLI 与脚本化的 remap/verification 命令与流程说明；

建议的 launch remap 示例与 EKF reset service 调用命令。

中长期必须落实的工程措施
在所有 adapter/bridge 中加入 timestamp sanity check 与自动修正（或拒绝异常 stamp）；

在系统级管道前端常驻 guard_relay（丢弃 NaN/Inf/超限观测）并强制 EKF 只订阅 safe topics；

在 EKF 实现加入数值防护：每次 predict/update 检查 X/P 是否 finite/合理，异常时回滚 last_safe_state 并发 diagnostics；

统一所有 launch use_sim_time=true、并固定“先启动 TF 等基础服务，再回放”的启动顺序；

若 bag 本身时间混乱，优先离线修正 bag（比运行时打补丁更稳健）。

下一步建议（你直接能马上做）
用我给的 scanner 在回放时确认哪些 topic 带异常 stamp。

使用 ros2 bag play 的 remap 选项隔离 bag 发布并运行 timestamp_normalizer 将 bag 消息桥接到 fixed topic。

Remap EKF 到 odometry_filtered 或 odometry_fixed，重启 EKF，观察 2–5 分钟内是否仍出现 TF 外推、invalid covariance 或 EKF 非有限问题。
